name: qa-client

on: [push]

jobs:
  lint:
    name: lint
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@v4
        with:
          lfs: true
      - name: setup node
        uses: actions/setup-node@v4
        with:
          node-version-file: ".nvmrc"
          cache: npm
          cache-dependency-path: |
            project/client/package-lock.json
            schema/package-lock.json
      - name: install dependencies (schema / npm)
        working-directory: schema
        run: npm ci
      - name: build schema
        working-directory: schema
        run: make build
      - name: install dependencies (client / npm)
        working-directory: project/client
        run: npm ci
      - name: lint
        working-directory: project/client
        run: make lint

  test:
    name: test
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@v4
        with:
          lfs: true
      - name: setup node
        uses: actions/setup-node@v4
        with:
          node-version-file: ".nvmrc"
          cache: npm
          cache-dependency-path: |
            project/client/package-lock.json
            schema/package-lock.json
      - name: install dependencies (schema / npm)
        working-directory: schema
        run: npm ci
      - name: build schema
        working-directory: schema
        run: make build
      - name: install dependencies (client / npm)
        working-directory: project/client
        run: npm ci
      - name: test
        working-directory: project/client
        run: make test
